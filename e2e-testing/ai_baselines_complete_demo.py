#!/usr/bin/env python3
"""
Complete AI Baselines Demo - Shows all effects clearly
"""

import json
import shutil
from pathlib import Path
from ai_quality_validation import AIQualityValidator

def main():
    print("ğŸš€ Complete AI Baselines Demo")
    print("=" * 50)
    print("This demonstrates the AI quality validation system:")
    print("1. Baseline deletion â†’ auto-creation")
    print("2. Threshold effects (0.8 vs 0.95)")
    print("3. Baseline corruption effects")
    print("=" * 50)
    
    # Demo 1: Baseline Deletion
    print("\nğŸ¯ DEMO 1: Baseline Deletion")
    print("-" * 30)
    
    baselines_dir = Path("ai_quality_baselines")
    text_baseline = baselines_dir / "text_baseline.json"
    
    # Backup original
    backup_file = text_baseline.with_suffix('.json.backup')
    shutil.copy2(text_baseline, backup_file)
    
    # Delete baseline
    text_baseline.unlink()
    print("ğŸ—‘ï¸  Deleted text_baseline.json")
    
    # Test with validator (should auto-create)
    validator = AIQualityValidator()
    test_content = "Daily Brief - 2024-01-15\n\nEmail Summary:\nâ€¢ New client inquiry - contact@newclient.com\nâ€¢ Project update - manager@company.com\n\nKey Insights:\nâ€¢ 2 new emails received\nâ€¢ 1 client inquiry requires response\nâ€¢ 1 project update to review\n\nAction Items:\nâ€¢ Respond to client inquiry\nâ€¢ Review project update\n\nGenerated by Person.ai"
    
    result = validator.validate_content_quality(test_content, "text")
    print(f"âœ… Auto-created baseline: {result['validations']['semantic_similarity']['details']}")
    
    # Restore original
    shutil.copy2(backup_file, text_baseline)
    backup_file.unlink()
    print("ğŸ”„ Restored original baseline")
    
    # Demo 2: Threshold Effects
    print("\nğŸ¯ DEMO 2: Threshold Effects")
    print("-" * 30)
    
    # Create content with varying similarity
    test_cases = [
        {
            "name": "Identical Content",
            "content": """Daily Brief - 2024-01-15

Email Summary:
â€¢ Quarterly Sales Report - john@company.com
â€¢ Client Meeting Request - sarah@client.com
â€¢ Invoice Payment Overdue - billing@vendor.com

Key Insights:
â€¢ 3 urgent items require immediate attention
â€¢ 2 client meetings scheduled for this week
â€¢ 1 invoice payment overdue
â€¢ New project proposal received

Action Items:
â€¢ Review quarterly sales report
â€¢ Schedule follow-up meeting with client
â€¢ Process invoice payment
â€¢ Prepare project proposal

Generated by Person.ai"""
        },
        {
            "name": "Similar Content",
            "content": """Daily Brief - 2024-01-15

Email Summary:
â€¢ Quarterly Sales Report - john@company.com
â€¢ Client Meeting Request - sarah@client.com
â€¢ Invoice Payment Overdue - billing@vendor.com

Key Insights:
â€¢ 3 urgent items require immediate attention
â€¢ 2 client meetings scheduled for this week
â€¢ 1 invoice payment overdue
â€¢ New project proposal received

Action Items:
â€¢ Review quarterly sales report
â€¢ Schedule follow-up meeting with client
â€¢ Process invoice payment
â€¢ Prepare project proposal

Generated by Person.ai"""
        },
        {
            "name": "Different Content",
            "content": """Morning Update - 2024-01-15

New Messages:
â€¢ Project Status Update - manager@company.com
â€¢ Budget Review Request - finance@company.com
â€¢ Team Meeting Reminder - admin@company.com

Summary:
â€¢ 3 new messages received
â€¢ 1 budget review needed
â€¢ 1 team meeting today

Tasks:
â€¢ Review project status
â€¢ Prepare budget review
â€¢ Attend team meeting

Created by Person.ai"""
        }
    ]
    
    for test_case in test_cases:
        print(f"\nğŸ“ {test_case['name']}:")
        
        # Test with 0.8 threshold
        class ThresholdValidator(AIQualityValidator):
            def __init__(self, threshold):
                super().__init__()
                self.threshold = threshold
            
            def _validate_semantic_similarity(self, content: str, content_type: str):
                baseline_key = f"{content_type}_baseline"
                if baseline_key not in self.baselines:
                    return {"score": 0.0, "passed": False, "details": "No baseline available"}
                
                baseline = self.baselines[baseline_key]
                similarity = self._calculate_similarity(content, baseline["content"])
                
                passed = similarity >= self.threshold
                
                return {
                    "score": similarity,
                    "passed": passed,
                    "details": f"Similarity: {similarity:.3f} (threshold: {self.threshold})",
                    "similarity": similarity,
                    "baseline_created": baseline["created_at"]
                }
        
        validator_08 = ThresholdValidator(0.8)
        validator_95 = ThresholdValidator(0.95)
        
        result_08 = validator_08.validate_content_quality(test_case['content'], "text")
        result_95 = validator_95.validate_content_quality(test_case['content'], "text")
        
        score_08 = result_08['validations']['semantic_similarity']['score']
        passed_08 = result_08['validations']['semantic_similarity']['passed']
        score_95 = result_95['validations']['semantic_similarity']['score']
        passed_95 = result_95['validations']['semantic_similarity']['passed']
        
        print(f"   Threshold 0.8:  {score_08:.3f} - {'âœ… PASS' if passed_08 else 'âŒ FAIL'}")
        print(f"   Threshold 0.95: {score_95:.3f} - {'âœ… PASS' if passed_95 else 'âŒ FAIL'}")
        
        if passed_08 and not passed_95:
            print(f"   ğŸ¯ BREAKPOINT: Passes 0.8 but fails 0.95!")
        elif not passed_08 and not passed_95:
            print(f"   ğŸ“‰ Fails both thresholds")
        elif passed_08 and passed_95:
            print(f"   ğŸ“ˆ Passes both thresholds")
    
    # Demo 3: Baseline Corruption
    print("\nğŸ¯ DEMO 3: Baseline Corruption")
    print("-" * 30)
    
    # Corrupt the baseline
    with open(text_baseline, 'r') as f:
        baseline_data = json.load(f)
    
    original_content = baseline_data["content"]
    baseline_data["content"] = "COMPLETELY DIFFERENT CONTENT - NOT SIMILAR AT ALL"
    
    with open(text_baseline, 'w') as f:
        json.dump(baseline_data, f, indent=2)
    
    print("ğŸ”§ Corrupted baseline content")
    
    # Test with corrupted baseline
    validator = AIQualityValidator()
    result = validator.validate_content_quality(test_content, "text")
    score = result['validations']['semantic_similarity']['score']
    passed = result['validations']['semantic_similarity']['passed']
    
    print(f"   Score: {score:.3f}")
    print(f"   Passed: {'âœ… YES' if passed else 'âŒ NO'}")
    print(f"   Details: {result['validations']['semantic_similarity']['details']}")
    
    # Restore original
    baseline_data["content"] = original_content
    with open(text_baseline, 'w') as f:
        json.dump(baseline_data, f, indent=2)
    
    print("ğŸ”„ Restored original baseline")
    
    print("\nğŸ‰ DEMO COMPLETE!")
    print("=" * 50)
    print("Key takeaways:")
    print("â€¢ Deleted baselines â†’ auto-created (test 'passes' but resets baseline)")
    print("â€¢ Higher thresholds â†’ stricter validation (0.8 â†’ 0.95)")
    print("â€¢ Corrupted baselines â†’ low similarity scores")
    print("â€¢ System handles edge cases gracefully")

if __name__ == "__main__":
    main()
